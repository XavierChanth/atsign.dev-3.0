<!-- Auto collapsible section menu -->

<ul class="list-unstyled collapsible-sidebar">
  {{ $currentPage := . -}}
  {{ $section := $currentPage.Section -}}
  {{ range (where .Site.Sections "Section" "in" $section) }}
    {{ range .Sections.ByWeight.Reverse }}
      {{ if eq .Params.sidebarCollapse false }}
        {{ if eq .Params.showRoot true }}
          {{ .Scratch.Set "page" .CurrentSection }}
        {{ else }}
          {{ $list := sort .CurrentSection.Pages ".Params.order" "asc"}}
          {{ .Scratch.Set "page" (index $list 0) }}
        {{ end }}
        {{ $active := in $currentPage.RelPermalink .RelPermalink }}
        {{ $page := .Scratch.Get "page" }}
        {{ $link := $page.RelPermalink }}
        <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ $link }}"><span style="margin-left: 20px;">{{ .Title }}</span></a></li>
      {{ else }}
        {{ $active := in $currentPage.RelPermalink .RelPermalink }}
        <li class="mb-1">
          <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#section-{{ md5 .Title }}" aria-expanded="{{ if $active }}true{{ else }}false{{ end }}">
            {{ .Title }}
          </button>
          <div class="collapse{{ if $active }} show{{ end }}" id="section-{{ md5 .Title }}">
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
              {{ range .Pages }}
                {{ if eq .Params.sidebarCollapse false }}
                  {{ if eq .Params.showRoot true }}
                    {{ .Scratch.Set "page" .CurrentSection }}
                  {{ else }}
                    {{ $list := sort .CurrentSection.Pages ".Params.order" "asc"}}
                    {{ .Scratch.Set "page" (index $list 0) }}
                  {{ end }}
                  {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                  {{ $page := .Scratch.Get "page" }}
                  {{ $link := $page.RelPermalink }}
                  <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ $link }}"><span style="margin-left: 16px;">{{ .Title }}</span></a></li>
                {{ else }}
                  {{ if .IsNode }}
                    {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                    <li class="my-1 ms-3">
                      <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#section-{{ md5 .Title }}" aria-expanded="{{ if $active }}true{{ else }}false{{ end }}">
                        {{ .Title }}
                      </button>
                      <div class="collapse{{ if $active }} show{{ end }}" id="section-{{ md5 .Title }}">
                        <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                          {{ range .Pages }}
                            {{ if eq .Params.sidebarCollapse false }}
                              {{ if eq .Params.showRoot true }}
                                {{ .Scratch.Set "page" .CurrentSection }}
                              {{ else }}
                                {{ $list := sort .CurrentSection.Pages ".Params.order" "asc"}}
                                {{ .Scratch.Set "page" (index $list 0) }}
                              {{ end }}
                              {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                              {{ $page := .Scratch.Get "page" }}
                              {{ $link := $page.RelPermalink }}
                            <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ $link }}"><span style="margin-left: 16px;">{{ .Title }}</span></a></li>
                            {{ else }}
                              {{ if .IsNode }}
                                {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                <li class="my-1 ms-3">
                                  <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#section-{{ md5 .Title }}" aria-expanded="{{ if $active }}true{{ else }}false{{ end }}">
                                    {{ .Title }}
                                  </button>
                                  <div class="collapse{{ if $active }} show{{ end }}" id="section-{{ md5 .Title }}">
                                    <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                      {{ range .Pages }}
                                        {{ if eq .Params.sidebarCollapse false }}
                                          {{ if eq .Params.showRoot true }}
                                            {{ .Scratch.Set "page" .CurrentSection }}
                                          {{ else }}
                                            {{ $list := sort .CurrentSection.Pages ".Params.order" "asc"}}
                                            {{ .Scratch.Set "page" (index $list 0) }}
                                          {{ end }}
                                          {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                          {{ $page := .Scratch.Get "page" }}
                                          {{ $link := $page.RelPermalink }}
                                          <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ $link }}"><span style="margin-left: 16px;">{{ .Title }}</span></a></li>
                                        {{ else }}
                                          {{ if .IsNode }}
                                          {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                            <li class="my-1 ms-3">
                                              <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#section-{{ md5 .Title }}" aria-expanded="{{ if $active }}true{{ else }}false{{ end }}">
                                                {{ .Title }}
                                              </button>
                                              <div class="collapse{{ if $active }} show{{ end }}" id="section-{{ md5 .Title }}">
                                                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                                  {{ range .Pages }}
                                                    {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                                    <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                                  {{ end }}
                                                </ul>
                                              </div>
                                            </li>
                                          {{else}}
                                            {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                            <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                          {{ end }}
                                        {{ end }}
                                      {{ end }}
                                    </ul>
                                  </div>
                                </li>
                              {{ else }}
                                {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ .Permalink }}">{{ .Title }}</a></li>
                              {{ end }}
                            {{ end }}
                          {{ end }}
                        </ul>
                      </div>
                    </li>
                  {{ else }}
                    {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                    <li><a class="docs-link rounded{{ if $active }} active{{ end }}" href="{{ .Permalink }}">{{ .Title }}</a></li>
                  {{ end }}
                {{ end }}
              {{ end }}
            </ul>
          </div>
        </li>
      {{ end }}
    {{ end }}
  {{ end }}
</ul>
